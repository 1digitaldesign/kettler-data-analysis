{
  "$schema": "http://json_schema.org/draft_07/schema#",
  "title": "kettler_data_analysis_schema",
  "description": "complete_data_schema_with_primary_keys_(pk)_and_foreign_keys_(fk)_for_all_entities",
  "version": "1.0.0",
  "tables": {
    "firms": {
      "description": "real_estate_firm_licenses",
      "primary_key": "firm_license",
      "primary_key_type": "string",
      "primary_key_format": "^[0_9]{10}$",
      "primary_key_description": "10_digit_virginia_dpor_license_number",
      "foreign_keys": [
        {
          "field": "individual_license",
          "references": "individual_licenses.license_number",
          "relationship": "many_to_one",
          "required": false,
          "description": "optional_reference_to_individual_license"
        }
      ],
      "fields": {
        "firm_license": {
          "type": "string",
          "required": true,
          "unique": true,
          "format": "^[0_9]{10}$",
          "description": "10_digit_virginia_dpor_license_number_(pk)",
          "example": "0226025311"
        },
        "firm_name": {
          "type": "string",
          "required": true,
          "description": "legal_name_of_the_firm",
          "example": "kettler_management_inc"
        },
        "license_type": {
          "type": "string",
          "required": true,
          "description": "type_of_license",
          "example": "real_estate_firm_license"
        },
        "firm_type": {
          "type": "string",
          "required": false,
          "description": "legal_entity_type",
          "example": "corporation"
        },
        "address": {
          "type": "string",
          "required": true,
          "description": "business_address",
          "example": "8255_greensboro_dr_ste_200,_mclean,_va_22102"
        },
        "state": {
          "type": "string",
          "required": true,
          "format": "^[a_z]{2}$",
          "description": "two_letter_state_code",
          "example": "va"
        },
        "principal_broker": {
          "type": "string",
          "required": true,
          "description": "name_of_principal_broker",
          "example": "skidmore_caitlin_marie"
        },
        "initial_cert_date": {
          "type": "string",
          "format": "date",
          "required": false,
          "description": "initial_certification_date_(yyyy_mm_dd)",
          "example": "2014_10_31"
        },
        "expiration_date": {
          "type": "string",
          "format": "date",
          "required": false,
          "description": "license_expiration_date_(yyyy_mm_dd)",
          "example": "2026_10_31"
        },
        "individual_license": {
          "type": "string",
          "required": false,
          "format": "^[0_9]{10}$",
          "description": "fk_to_individual_licenses.license_number",
          "example": "0225258285"
        },
        "gap_years": {
          "type": "number",
          "required": false,
          "description": "years_between_firm_license_and_principal_broker_license",
          "example": 11
        }
      },
      "indexes": [
        "firm_name",
        "state",
        "principal_broker",
        "address"
      ],
      "constraints": {
        "firm_license_unique": "firm_license_must_be_unique",
        "principal_broker_required": "principal_broker_cannot_be_null",
        "address_required": "address_cannot_be_null"
      }
    },
    "individual_licenses": {
      "description": "individual_real_estate_licenses",
      "primary_key": "license_number",
      "primary_key_type": "string",
      "primary_key_format": "^[0_9]{10}$",
      "primary_key_description": "10_digit_license_number",
      "foreign_keys": [],
      "fields": {
        "license_number": {
          "type": "string",
          "required": true,
          "unique": true,
          "format": "^[0_9]{10}$",
          "description": "10_digit_license_number_(pk)",
          "example": "0225258285"
        },
        "name": {
          "type": "string",
          "required": true,
          "description": "license_holder_name",
          "example": "skidmore,_caitlin_marie"
        },
        "address": {
          "type": "string",
          "required": false,
          "description": "address_associated_with_license",
          "example": "frisco,_tx_75034"
        },
        "license_type": {
          "type": "string",
          "required": true,
          "description": "type_of_license",
          "example": "real_estate_individual"
        },
        "board": {
          "type": "string",
          "required": false,
          "description": "regulatory_board",
          "example": "real_estate_board"
        },
        "state": {
          "type": "string",
          "required": true,
          "format": "^[a_z]{2}$",
          "description": "two_letter_state_code",
          "example": "tx"
        },
        "expiration_date": {
          "type": "string",
          "format": "date",
          "required": false,
          "description": "license_expiration_date_(yyyy_mm_dd)"
        }
      },
      "indexes": [
        "name",
        "state",
        "license_type"
      ],
      "constraints": {
        "license_number_unique": "license_number_must_be_unique",
        "name_required": "name_cannot_be_null"
      }
    },
    "connections": {
      "description": "connections_between_firms_and_individuals",
      "primary_key": "connection_id",
      "primary_key_type": "string",
      "primary_key_format": "^[a_f0_9]{32}$",
      "primary_key_description": "auto_generated_connection_id_(md5_hash)",
      "foreign_keys": [
        {
          "field": "firm_license",
          "references": "firms.firm_license",
          "relationship": "many_to_one",
          "required": false,
          "description": "reference_to_firm"
        },
        {
          "field": "license_number",
          "references": "individual_licenses.license_number",
          "relationship": "many_to_one",
          "required": false,
          "description": "reference_to_individual_license"
        }
      ],
      "fields": {
        "connection_id": {
          "type": "string",
          "required": true,
          "unique": true,
          "description": "auto_generated_connection_id_(pk)",
          "example": "abc123def456..."
        },
        "firm_license": {
          "type": "string",
          "required": false,
          "format": "^[0_9]{10}$",
          "description": "fk_to_firms.firm_license",
          "example": "0226025311"
        },
        "license_number": {
          "type": "string",
          "required": false,
          "format": "^[0_9]{10}$",
          "description": "fk_to_individual_licenses.license_number",
          "example": "0225258285"
        },
        "connection_type": {
          "type": "string",
          "required": true,
          "description": "type_of_connection",
          "enum": [
            "principal_broker",
            "same_address",
            "same_address_as_known_firm",
            "known_firm_match",
            "professional_association",
            "corporate_relationship"
          ],
          "example": "principal_broker"
        },
        "connection_detail": {
          "type": "string",
          "required": false,
          "description": "detailed_description_of_connection",
          "example": "listed_as_principal_broker:_skidmore_caitlin_marie"
        },
        "state": {
          "type": "string",
          "required": false,
          "format": "^[a_z]{2}$",
          "description": "state_where_connection_exists",
          "example": "va"
        },
        "firm_name": {
          "type": "string",
          "required": false,
          "description": "firm_name_(denormalized_for_convenience)",
          "example": "kettler_management_inc"
        },
        "verified": {
          "type": "boolean",
          "required": false,
          "description": "whether_connection_has_been_verified",
          "default": false
        },
        "analysis_date": {
          "type": "string",
          "format": "date",
          "required": false,
          "description": "date_connection_was_identified_(yyyy_mm_dd)"
        }
      },
      "indexes": [
        "firm_license",
        "license_number",
        "connection_type",
        "state"
      ],
      "constraints": {
        "connection_id_unique": "connection_id_must_be_unique",
        "connection_type_required": "connection_type_cannot_be_null"
      }
    },
    "research_outputs": {
      "description": "research_analysis_outputs_and_findings",
      "primary_key": "research_id",
      "primary_key_type": "string",
      "primary_key_format": "^[a_f0_9]{32}$",
      "primary_key_description": "auto_generated_research_id_(md5_hash_of_file_path)",
      "foreign_keys": [
        {
          "field": "firm_license",
          "references": "firms.firm_license",
          "relationship": "many_to_one",
          "required": false,
          "description": "reference_to_firm_if_research_is_firm_specific"
        },
        {
          "field": "license_number",
          "references": "individual_licenses.license_number",
          "relationship": "many_to_one",
          "required": false,
          "description": "reference_to_individual_license_if_research_is_license_specific"
        }
      ],
      "fields": {
        "research_id": {
          "type": "string",
          "required": true,
          "unique": true,
          "description": "auto_generated_research_id_(pk)",
          "example": "def456ghi789..."
        },
        "file_path": {
          "type": "string",
          "required": true,
          "description": "relative_path_to_research_file",
          "example": "research/connections/caitlin_skidmore_connections.json"
        },
        "category": {
          "type": "string",
          "required": true,
          "enum": [
            "connections",
            "violations",
            "anomalies",
            "evidence",
            "verification",
            "timelines",
            "summaries",
            "search_results",
            "analysis",
            "va_dpor_complaint"
          ],
          "description": "research_category",
          "example": "connections"
        },
        "firm_license": {
          "type": "string",
          "required": false,
          "format": "^[0_9]{10}$",
          "description": "fk_to_firms.firm_license_(if_firm_specific)",
          "example": "0226025311"
        },
        "license_number": {
          "type": "string",
          "required": false,
          "format": "^[0_9]{10}$",
          "description": "fk_to_individual_licenses.license_number_(if_license_specific)",
          "example": "0225258285"
        },
        "analysis_date": {
          "type": "string",
          "format": "date",
          "required": false,
          "description": "date_analysis_was_performed_(yyyy_mm_dd)",
          "example": "2025_12_07"
        },
        "findings_summary": {
          "type": "string",
          "required": false,
          "description": "brief_summary_of_findings",
          "example": "found_38_firms_connected_to_caitlin_skidmore"
        },
        "status": {
          "type": "string",
          "required": false,
          "enum": [
            "complete",
            "in_progress",
            "pending",
            "verified"
          ],
          "description": "research_status",
          "example": "complete"
        },
        "metadata": {
          "type": "object",
          "required": false,
          "description": "additional_metadata_from_research_file"
        }
      },
      "indexes": [
        "category",
        "firm_license",
        "license_number",
        "analysis_date",
        "status"
      ],
      "constraints": {
        "research_id_unique": "research_id_must_be_unique",
        "file_path_unique": "file_path_should_be_unique",
        "category_required": "category_cannot_be_null"
      }
    },
    "violations": {
      "description": "regulatory_violations_identified",
      "primary_key": "violation_id",
      "primary_key_type": "string",
      "primary_key_format": "^[a_f0_9]{32}$",
      "primary_key_description": "auto_generated_violation_id",
      "foreign_keys": [
        {
          "field": "firm_license",
          "references": "firms.firm_license",
          "relationship": "many_to_one",
          "required": false,
          "description": "reference_to_firm_if_violation_is_firm_specific"
        },
        {
          "field": "license_number",
          "references": "individual_licenses.license_number",
          "relationship": "many_to_one",
          "required": false,
          "description": "reference_to_individual_license_if_violation_is_license_specific"
        }
      ],
      "fields": {
        "violation_id": {
          "type": "string",
          "required": true,
          "unique": true,
          "description": "auto_generated_violation_id_(pk)"
        },
        "violation_type": {
          "type": "string",
          "required": true,
          "enum": [
            "principal_broker_gap",
            "geographic_violation",
            "supervision_impossibility",
            "unlicensed_practice",
            "timeline_impossibility",
            "regulatory_violation",
            "50_mile_rule_violation"
          ],
          "description": "type_of_violation",
          "example": "principal_broker_gap"
        },
        "firm_license": {
          "type": "string",
          "required": false,
          "format": "^[0_9]{10}$",
          "description": "fk_to_firms.firm_license",
          "example": "0226025311"
        },
        "license_number": {
          "type": "string",
          "required": false,
          "format": "^[0_9]{10}$",
          "description": "fk_to_individual_licenses.license_number",
          "example": "0225258285"
        },
        "severity": {
          "type": "string",
          "required": false,
          "enum": [
            "high",
            "medium",
            "low"
          ],
          "description": "violation_severity",
          "example": "high"
        },
        "description": {
          "type": "string",
          "required": true,
          "description": "detailed_description_of_violation",
          "example": "firm_licensed_10.5_years_before_principal_broker"
        },
        "evidence_files": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "required": false,
          "description": "list_of_evidence_file_paths",
          "example": [
            "research/va_dpor_complaint/principal_broker_gap_analysis.json"
          ]
        },
        "state": {
          "type": "string",
          "required": false,
          "format": "^[a_z]{2}$",
          "description": "state_where_violation_occurred",
          "example": "va"
        },
        "identified_date": {
          "type": "string",
          "format": "date",
          "required": false,
          "description": "date_violation_was_identified_(yyyy_mm_dd)"
        }
      },
      "indexes": [
        "violation_type",
        "firm_license",
        "license_number",
        "severity",
        "state"
      ],
      "constraints": {
        "violation_id_unique": "violation_id_must_be_unique",
        "violation_type_required": "violation_type_cannot_be_null"
      }
    },
    "evidence": {
      "description": "evidence_documents_and_extracted_data",
      "primary_key": "evidence_id",
      "primary_key_type": "string",
      "primary_key_format": "^[a_f0_9]{32}$",
      "primary_key_description": "auto_generated_evidence_id",
      "foreign_keys": [
        {
          "field": "violation_id",
          "references": "violations.violation_id",
          "relationship": "many_to_one",
          "required": false,
          "description": "reference_to_violation_if_evidence_supports_violation"
        }
      ],
      "fields": {
        "evidence_id": {
          "type": "string",
          "required": true,
          "unique": true,
          "description": "auto_generated_evidence_id_(pk)"
        },
        "file_path": {
          "type": "string",
          "required": true,
          "description": "path_to_evidence_file",
          "example": "evidence/pdfs/lease_termination.pdf"
        },
        "evidence_type": {
          "type": "string",
          "required": true,
          "enum": [
            "pdf",
            "excel",
            "email",
            "legal_document",
            "linkedin_profile",
            "web_page",
            "correspondence"
          ],
          "description": "type_of_evidence",
          "example": "pdf"
        },
        "violation_id": {
          "type": "string",
          "required": false,
          "description": "fk_to_violations.violation_id"
        },
        "extracted_data": {
          "type": "object",
          "required": false,
          "description": "extracted_entities_and_data_from_evidence"
        },
        "extraction_date": {
          "type": "string",
          "format": "date",
          "required": false,
          "description": "date_evidence_was_extracted_(yyyy_mm_dd)"
        },
        "source": {
          "type": "string",
          "required": false,
          "description": "source_of_evidence",
          "example": "lease_termination_document"
        }
      },
      "indexes": [
        "evidence_type",
        "violation_id",
        "extraction_date"
      ],
      "constraints": {
        "evidence_id_unique": "evidence_id_must_be_unique",
        "file_path_required": "file_path_cannot_be_null"
      }
    }
  },
  "relationships": [
    {
      "from_table": "firms",
      "from_field": "individual_license",
      "to_table": "individual_licenses",
      "to_field": "license_number",
      "relationship_type": "many_to_one",
      "required": false,
      "description": "firm_may_reference_an_individual_license"
    },
    {
      "from_table": "connections",
      "from_field": "firm_license",
      "to_table": "firms",
      "to_field": "firm_license",
      "relationship_type": "many_to_one",
      "required": false,
      "description": "connection_references_a_firm"
    },
    {
      "from_table": "connections",
      "from_field": "license_number",
      "to_table": "individual_licenses",
      "to_field": "license_number",
      "relationship_type": "many_to_one",
      "required": false,
      "description": "connection_references_an_individual_license"
    },
    {
      "from_table": "research_outputs",
      "from_field": "firm_license",
      "to_table": "firms",
      "to_field": "firm_license",
      "relationship_type": "many_to_one",
      "required": false,
      "description": "research_output_may_reference_a_firm"
    },
    {
      "from_table": "research_outputs",
      "from_field": "license_number",
      "to_table": "individual_licenses",
      "to_field": "license_number",
      "relationship_type": "many_to_one",
      "required": false,
      "description": "research_output_may_reference_an_individual_license"
    },
    {
      "from_table": "violations",
      "from_field": "firm_license",
      "to_table": "firms",
      "to_field": "firm_license",
      "relationship_type": "many_to_one",
      "required": false,
      "description": "violation_may_reference_a_firm"
    },
    {
      "from_table": "violations",
      "from_field": "license_number",
      "to_table": "individual_licenses",
      "to_field": "license_number",
      "relationship_type": "many_to_one",
      "required": false,
      "description": "violation_may_reference_an_individual_license"
    },
    {
      "from_table": "evidence",
      "from_field": "violation_id",
      "to_table": "violations",
      "to_field": "violation_id",
      "relationship_type": "many_to_one",
      "required": false,
      "description": "evidence_may_support_a_violation"
    }
  ],
  "data_files": {
    "firms": {
      "file_path": "data/cleaned/firms.json",
      "format": "json",
      "structure": "array",
      "estimated_records": 38
    },
    "individual_licenses": {
      "file_path": "data/cleaned/individual_licenses.json",
      "format": "json",
      "structure": "array",
      "estimated_records": 40
    },
    "connections": {
      "file_path": "research/connections/caitlin_skidmore_connections.json",
      "format": "json",
      "structure": "object",
      "estimated_records": "variable"
    },
    "research_outputs": {
      "file_path": "research/",
      "format": "json",
      "structure": "multiple_files",
      "estimated_records": 350
    }
  }
}