version: '3.8'

services:
  api-gateway:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /app/api-gateway
    ports:
      - "8000:8000"
    environment:
      - PORT=8000
      - ANALYSIS_SERVICE_URL=http://analysis-service:8001
      - SCRAPING_SERVICE_URL=http://scraping-service:8002
      - VALIDATION_SERVICE_URL=http://validation-service:8003
      - VECTOR_SERVICE_URL=http://vector-service:8004
      - GIS_SERVICE_URL=http://gis-service:8005
      - ACRIS_SERVICE_URL=http://acris-service:8006
      - DATA_SERVICE_URL=http://data-service:8007
    volumes:
      - ../:/app/root:ro
    command: ["python", "-m", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]

  analysis-service:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /app/analysis-service
    ports:
      - "8001:8001"
    environment:
      - PORT=8001
    volumes:
      - ../:/app/root:ro
    command: ["python", "-m", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001"]

  scraping-service:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /app/scraping-service
    ports:
      - "8002:8002"
    environment:
      - PORT=8002
    volumes:
      - ../:/app/root:ro
    command: ["python", "-m", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8002"]

  validation-service:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /app/validation-service
    ports:
      - "8003:8003"
    environment:
      - PORT=8003
    volumes:
      - ../:/app/root:ro
    command: ["python", "-m", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8003"]

  vector-service:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /app/vector-service
    ports:
      - "8004:8004"
    environment:
      - PORT=8004
    volumes:
      - ../:/app/root:ro
    command: ["python", "-m", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8004"]

  gis-service:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /app/gis-service
    ports:
      - "8005:8005"
    environment:
      - PORT=8005
    volumes:
      - ../:/app/root:ro
    command: ["python", "-m", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8005"]

  acris-service:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /app/acris-service
    ports:
      - "8006:8006"
    environment:
      - PORT=8006
    volumes:
      - ../:/app/root:ro
    command: ["python", "-m", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8006"]

  data-service:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /app/data-service
    ports:
      - "8007:8007"
    environment:
      - PORT=8007
    volumes:
      - ../:/app/root:ro
    command: ["python", "-m", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8007"]

  google-drive-service:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /app/google-drive-service
    ports:
      - "8008:8008"
    environment:
      - PORT=8008
      - GOOGLE_APPLICATION_CREDENTIALS=/app/root/config/gcp-credentials.json
      - GOOGLE_DRIVE_TOKEN_FILE=/app/token.pickle
      - GOOGLE_DRIVE_CREDENTIALS_FILE=/app/credentials.json
    volumes:
      - ../:/app/root:ro
      - ./google-drive-service/token.pickle:/app/token.pickle
      - ./google-drive-service/credentials.json:/app/credentials.json
    command: ["python", "-m", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8008"]
